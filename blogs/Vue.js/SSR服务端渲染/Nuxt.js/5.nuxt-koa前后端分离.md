# 结合koa搭建前后端分离模版
## 前言
前面两章分别介绍了**nuxt结合axios**进行异步请求、**nuxt结合koa**启动服务的过程。这一篇我们讲一讲怎么搭建一个前后端分离的模版。有了前面的基础，这里就比较简单了，基本上就是前面两个内容的整合。不同点是，在这一篇的内容中，添加了两个官方提供的工具模块
1. `@nuxtjs/axios`
2. `@nuxtjs/proxy`

### 模块介绍
#### 1. @nuxtjs/axios
官方是这么介绍的
> Secure and Easy Axios integration with Nuxt.js.
>> 很简洁，就是一个安全、简单的Axios和Nuxt.js的集合

>* Automatically set base URL for client & server side
* Exposes `setToken` function to `$axios` so we can easily and globally set authentication tokens
* Automatically enables `withCredentials` when requesting to base URL
* Proxy request headers in SSR (Useful for auth)
* Fetch Style requests
* Integrated with Nuxt.js Progressbar while making requests
* Integrated with [Proxy Module](https://github.com/nuxt-community/proxy-module)
* Auto retry requests with [axios-retry](https://github.com/softonic/axios-retry)
>>* 自动设置客户端和服务器端的`baseURL`
  * 将`setToken`函数暴露给$ axios，以便我们可以轻松地和全局地设置身份验证令牌
  * 请求基URL时自动启用`withCredentials`
  * SSR中的代理请求标头（用于身份验证）
  * 获取样式请求
  * 在提出请求时与Nuxt.js进度条集成
  * 与`Proxy Module代`理模块集成
  * 使用`axios-retry`自动重试请求

详细内容可以看看[官方文档](https://axios.nuxtjs.org/)

#### 2. @nuxtjs/proxy
官方简介
>The one-liner node.js http-proxy middleware solution for Nuxt.js using [http-proxy-middleware](https://github.com/chimurai/http-proxy-middleware)
>>是一个使用了`http-proxy-middleware`的http代理中间件

**注意哦，@nuxtjs/axios已经整合了@nuxtjs/proxy**

## 开始搭建
讲了这么多废话，来重点吧。
init完之后，npm一下
`npm install nuxt @nuxtjs/axios koa koa-router`
先把nuxt页面渲染的部分搭建好，就是放几个页面进`pages/`目录下
![](
  data:image/png;base64,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
)

index.vue就是hello world，不贴了

foo.vue
```js
<template>
  <h1>{{data}}</h1>
</template>

<script>
export default {
  async asyncData({ app }) {
    const { data } = await app.$axios.post('/api/foo')
    return { data }
  }
}
</script>
```
bar.vue
```js
<template>
  <h1>{{data}}</h1>
</template>

<script>
export default {
  async asyncData({ app }) {
    const { data } = await app.$axios.get("/api/bar");
    return { data };
  }
};
</script>
```



我在`package.json`的`scripts`中加入了
```js
"scripts": {
    "nuxt-dev": "nuxt",
    "nuxt-build": "nuxt build",
    "nuxt-start": "nuxt start",
    ......
}
```

## 代码地址

## 参考
默认3000端口
如果要更换端口，必须在package.json中修改端口